# Paper Digest 配置指南

## 快速开始（5分钟）

### 步骤 1: 获取 Exa API Key

1. 访问 https://exa.ai/
2. 点击右上角 "Sign Up" 注册账号
3. 登录后，进入 Dashboard
4. 找到 "API Keys" 部分
5. 复制你的 API Key

**免费额度**: Exa 提供 $10 免费额度，足够测试和小规模使用。

### 步骤 2: 配置环境变量

编辑项目根目录的 `.env` 文件，找到这一行：

```bash
EXA_API_KEY=YOUR_EXA_API_KEY_HERE
```

替换为你的真实 API Key：

```bash
EXA_API_KEY=your_actual_api_key_here
```

### 步骤 3: 运行测试

```bash
cd paper_digest
python digest_agent.py
```

程序会自动处理三篇小红书帖子，每篇大约需要 2-3 分钟。

---

## 预期输出

###  1. 控制台输出

```
======================================================================
📚 Paper Digest Agent - 论文深度整理
======================================================================

正在启动...
🔌 连接 Exa MCP 服务器...
✅ Agent 已创建

请提供小红书链接...

======================================================================
开始处理第 1/3 篇论文
======================================================================

🤖 正在获取小红书帖子...
✅ 帖子内容获取成功

🤖 正在提取论文标题...
✅ 论文标题: XXX

🤖 正在搜索 PDF...
✅ 找到 PDF 链接: https://...

🤖 正在下载 PDF...
✅ PDF 下载成功! (3.5 MB)

🤖 正在生成论文整理...
✅ 论文整理生成完成!

🤖 正在保存到 Notion...
✅ 已保存到 Notion!
   查看链接: https://notion.so/...

✅ 第 1 篇完成！

======================================================================
```

### 2. 生成的文件

#### `paper_digest/pdfs/`
- 下载的 PDF 文件
- 文件名格式: `{论文标题}.pdf`

#### `paper_digest/outputs/`
- Markdown 格式的论文整理
- 文件名格式: `{论文标题}.md`

### 3. Notion 数据库

每篇论文会创建一个新的 Page，包含：

**Properties（属性）**:
- Name: 论文标题
- Source URL: 小红书链接
- PDF Link: PDF 下载链接
- Tags: ["论文整理", "深度分析"]
- Summary: 摘要（前200字）

**Page Content（正文）**:
完整的结构化论文整理，包含：
- 研究背景
- 核心方法
- 实验结果
- 局限性
- 未来方向
- 等等...

---

## 故障排查

### 问题 1: 提示 "未配置 EXA_API_KEY"

**原因**: .env 文件中的 API Key 未配置或配置错误

**解决**:
1. 检查 .env 文件中的 `EXA_API_KEY` 是否已替换为真实值
2. 确保没有多余的空格或引号
3. 重新运行程序

### 问题 2: Exa MCP Server 连接失败

**原因**: 网络问题或 npx 未安装

**解决**:
```bash
# 检查 npx 是否可用
npx --version

# 如果没有，安装 Node.js
# 访问 https://nodejs.org/

# 检查代理配置
echo $http_proxy
```

### 问题 3: PDF 下载失败

**原因**: 链接失效、代理问题或磁盘空间不足

**解决**:
1. 检查代理配置（.env 中的 http_proxy）
2. 确保 `paper_digest/pdfs/` 目录可写
3. 查看控制台中的 PDF 链接是否有效

### 问题 4: Notion 保存失败

**原因**: Token 权限不足或 Database ID 错误

**解决**:
1. 确认 Notion Integration 已添加到目标数据库
2. 检查 NOTION_DATABASE_ID 是否正确
3. 查看 Notion 数据库 schema 是否包含必要字段（Name, Source URL, PDF Link, Tags, Summary）

### 问题 5: 论文整理内容质量不高

**原因**: 小红书内容信息不足，或未能下载 PDF

**解决**:
1. 确保 PDF 成功下载（可以基于 PDF 全文生成更好的整理）
2. 选择内容详细的小红书帖子
3. 手动编辑 `outputs/` 目录中的 Markdown 文件

---

## 高级配置

### 1. 自定义论文整理模板

编辑 `digest_template.md` 文件，添加或修改章节：

```markdown
## 🆕 你的自定义章节

[描述你想添加的内容]
```

### 2. 调整 LLM 模型

编辑 `digest_agent.py` 第 227 行：

```python
model="gpt-4o",  # 改为 gpt-4o-mini 以降低成本
```

### 3. 批量处理自定义链接

编辑 `digest_agent.py` 第 400-404 行的 `test_urls` 列表：

```python
test_urls = [
    "你的小红书链接1",
    "你的小红书链接2",
    "你的小红书链接3",
]
```

---

## 成本估算

### Exa API

- **免费额度**: $10
- **每次搜索**: ~$0.01-0.02
- **预计可处理**: 500-1000 篇论文

### OpenAI API

- **gpt-4o**: ~$0.005 per 1K tokens
- **每篇论文**: ~10K tokens输入 + 5K tokens输出 ≈ $0.08
- **三篇论文**: ~$0.24

### 总成本

处理三篇论文的总成本约 **$0.30**（假设已有免费额度）

---

## 常见问题

### Q: 可以不下载 PDF 直接生成整理吗？

A: 可以。如果 PDF 下载失败，程序会基于小红书内容生成整理。但质量会降低。

### Q: 支持哪些语言的论文？

A: 主要支持中英文。模板和提示词可以根据需要调整。

### Q: 可以集成到 chat.py 主流程吗？

A: 可以，但需要修改主流程代码。当前设计是完全独立的，避免影响主流程。

### Q: 生成的整理可以编辑吗？

A: 可以。整理保存在 `outputs/` 目录中，可以手动编辑 Markdown 文件，然后重新上传到 Notion。

---

## 下一步

1. **运行测试**: 按照上述步骤配置并运行
2. **检查输出**: 查看 Notion 中的结果
3. **调整模板**: 根据需要修改 `digest_template.md`
4. **批量处理**: 添加更多小红书链接

---

## 支持

如有问题，请检查：
1. [README.md](./README.md) - 功能说明
2. [digest_template.md](./digest_template.md) - 论文整理模板
3. 控制台错误信息
4. Notion 数据库权限

祝使用愉快！📚
